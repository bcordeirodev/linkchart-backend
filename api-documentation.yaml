openapi: 3.0.3
info:
  title: Link Charts API
  description: |
    API completa para o sistema de encurtamento de links Link Charts.

    ## Autenticação
    A API utiliza JWT (JSON Web Tokens) para autenticação. Após o login, você receberá um token que deve ser incluído no header `Authorization` como `Bearer {token}`.

    ## Rate Limiting
    - **Criação de links**: 30 requisições por minuto
    - **Operações críticas** (update/delete): 20 requisições por minuto
    - **Demais endpoints**: Sem limite específico

    ## Códigos de Status
    - `200` - Sucesso
    - `201` - Criado com sucesso
    - `400` - Erro de validação
    - `401` - Não autorizado
    - `403` - Acesso negado
    - `404` - Recurso não encontrado
    - `422` - Erro de validação de dados
    - `429` - Rate limit excedido
    - `500` - Erro interno do servidor

  version: 1.0.0
  contact:
    name: Link Charts API Support
    email: support@linkcharts.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000/api
    description: Servidor de desenvolvimento
  - url: https://api.linkcharts.com
    description: Servidor de produção

tags:
  - name: Auth
    description: Endpoints de autenticação
  - name: Links
    description: Gerenciamento de links encurtados
  - name: Analytics
    description: Dados analíticos e estatísticas
  - name: Redirect
    description: Redirecionamento de links

paths:
  # ==========================================
  # AUTENTICAÇÃO
  # ==========================================
  /auth/register:
    post:
      tags: [Auth]
      summary: Registrar novo usuário
      description: Cria uma nova conta de usuário no sistema
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password, password_confirmation]
              properties:
                name:
                  type: string
                  example: "João Silva"
                  description: Nome completo do usuário
                email:
                  type: string
                  format: email
                  example: "joao@exemplo.com"
                  description: Email único do usuário
                password:
                  type: string
                  format: password
                  minimum: 8
                  example: "senha123"
                  description: Senha (mínimo 8 caracteres)
                password_confirmation:
                  type: string
                  format: password
                  example: "senha123"
                  description: Confirmação da senha
      responses:
        '201':
          description: Usuário criado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Usuário registrado com sucesso"
                  user:
                    $ref: '#/components/schemas/User'
                  token:
                    type: string
                    example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
        '422':
          description: Erro de validação
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /auth/login:
    post:
      tags: [Auth]
      summary: Login de usuário
      description: Autentica um usuário e retorna um JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                  example: "joao@exemplo.com"
                password:
                  type: string
                  format: password
                  example: "senha123"
      responses:
        '200':
          description: Login realizado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Login realizado com sucesso"
                  user:
                    $ref: '#/components/schemas/User'
                  token:
                    type: string
                    example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
                  expires_in:
                    type: integer
                    example: 3600
                    description: Tempo de expiração do token em segundos
        '401':
          description: Credenciais inválidas
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Credenciais inválidas"

  /auth/google:
    post:
      tags: [Auth]
      summary: Login com Google
      description: Autentica usuário usando token do Google OAuth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token]
              properties:
                token:
                  type: string
                  example: "ya29.a0ARrdaM9..."
                  description: Token do Google OAuth
      responses:
        '200':
          description: Login com Google realizado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Login realizado com sucesso"
                  user:
                    $ref: '#/components/schemas/User'
                  token:
                    type: string
                    example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."

  /me:
    get:
      tags: [Auth]
      summary: Obter dados do usuário atual
      description: Retorna os dados do usuário autenticado
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Dados do usuário
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /logout:
    post:
      tags: [Auth]
      summary: Logout do usuário
      description: Invalida o token JWT do usuário
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout realizado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logout realizado com sucesso"

  # ==========================================
  # LINKS
  # ==========================================
  /gerar-url:
    post:
      tags: [Links]
      summary: Criar novo link encurtado
      description: |
        Cria um novo link encurtado com configurações personalizadas.

        **Rate Limit:** 30 requisições por minuto
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [original_url]
              properties:
                original_url:
                  type: string
                  format: uri
                  example: "https://www.exemplo.com/pagina-muito-longa"
                  description: URL original a ser encurtada
                title:
                  type: string
                  example: "Minha Página Especial"
                  description: Título descritivo do link
                description:
                  type: string
                  example: "Descrição detalhada do link"
                  description: Descrição opcional do link
                slug:
                  type: string
                  pattern: '^[a-zA-Z0-9\-_]+$'
                  example: "meu-link-especial"
                  description: Slug personalizado (opcional, será gerado automaticamente se não fornecido)
                expires_at:
                  type: string
                  format: date-time
                  example: "2024-12-31T23:59:59Z"
                  description: Data de expiração do link
                starts_in:
                  type: string
                  format: date-time
                  example: "2024-01-01T00:00:00Z"
                  description: Data de início de ativação do link
                is_active:
                  type: boolean
                  example: true
                  description: Se o link está ativo (padrão: true)
                utm_source:
                  type: string
                  example: "newsletter"
                  description: Parâmetro UTM source
                utm_medium:
                  type: string
                  example: "email"
                  description: Parâmetro UTM medium
                utm_campaign:
                  type: string
                  example: "summer-sale"
                  description: Parâmetro UTM campaign
                utm_term:
                  type: string
                  example: "discount"
                  description: Parâmetro UTM term
                utm_content:
                  type: string
                  example: "header-link"
                  description: Parâmetro UTM content
      responses:
        '201':
          description: Link criado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Link criado com sucesso"
                  data:
                    $ref: '#/components/schemas/Link'
        '422':
          description: Erro de validação
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /link:
    get:
      tags: [Links]
      summary: Listar todos os links do usuário
      description: Retorna uma lista paginada de todos os links do usuário autenticado
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Número da página
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          description: Itens por página
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 15
        - name: search
          in: query
          description: Buscar por título, URL ou slug
          schema:
            type: string
        - name: status
          in: query
          description: Filtrar por status
          schema:
            type: string
            enum: [active, inactive, all]
            default: all
      responses:
        '200':
          description: Lista de links
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Link'

  /link/{id}:
    get:
      tags: [Links]
      summary: Obter detalhes de um link específico
      description: Retorna os detalhes completos de um link pelo ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID do link
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: Detalhes do link
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Link'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Links]
      summary: Atualizar um link
      description: |
        Atualiza os dados de um link existente.

        **Rate Limit:** 20 requisições por minuto
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID do link
          schema:
            type: integer
            example: 123
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: "Novo Título"
                description:
                  type: string
                  example: "Nova descrição"
                original_url:
                  type: string
                  format: uri
                  example: "https://www.exemplo.com/nova-pagina"
                expires_at:
                  type: string
                  format: date-time
                  example: "2024-12-31T23:59:59Z"
                starts_in:
                  type: string
                  format: date-time
                  example: "2024-01-01T00:00:00Z"
                is_active:
                  type: boolean
                  example: false
                utm_source:
                  type: string
                  example: "social"
                utm_medium:
                  type: string
                  example: "facebook"
                utm_campaign:
                  type: string
                  example: "winter-campaign"
                utm_term:
                  type: string
                  example: "promo"
                utm_content:
                  type: string
                  example: "sidebar-ad"
      responses:
        '200':
          description: Link atualizado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Link atualizado com sucesso"
                  data:
                    $ref: '#/components/schemas/Link'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          description: Erro de validação
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    delete:
      tags: [Links]
      summary: Excluir um link
      description: |
        Remove permanentemente um link do sistema.

        **Rate Limit:** 20 requisições por minuto
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID do link
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: Link excluído com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Link removido com sucesso"
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /link/{id}/audit:
    get:
      tags: [Links]
      summary: Histórico de auditoria do link
      description: Retorna o histórico de alterações do link
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID do link
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: Histórico de auditoria
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditLog'

  /link/{slug}/analytics:
    get:
      tags: [Analytics]
      summary: Analytics específicos de um link
      description: Retorna dados analíticos detalhados para um link específico
      security:
        - bearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          description: Slug do link
          schema:
            type: string
            example: "meu-link"
        - name: start_date
          in: query
          description: Data de início (formato YYYY-MM-DD)
          schema:
            type: string
            format: date
            example: "2024-01-01"
        - name: end_date
          in: query
          description: Data de fim (formato YYYY-MM-DD)
          schema:
            type: string
            format: date
            example: "2024-01-31"
      responses:
        '200':
          description: Dados analíticos do link
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LinkAnalytics'

  /link/by-slug/{slug}:
    get:
      tags: [Links]
      summary: Obter link por slug (público)
      description: |
        Endpoint público para obter informações básicas de um link pelo slug.
        Não requer autenticação.
      parameters:
        - name: slug
          in: path
          required: true
          description: Slug do link
          schema:
            type: string
            example: "meu-link"
      responses:
        '200':
          description: Informações básicas do link
          content:
            application/json:
              schema:
                type: object
                properties:
                  slug:
                    type: string
                    example: "meu-link"
                  original_url:
                    type: string
                    example: "https://www.exemplo.com"
                  title:
                    type: string
                    example: "Meu Link"
                  is_active:
                    type: boolean
                    example: true
        '404':
          $ref: '#/components/responses/NotFound'

  # ==========================================
  # ANALYTICS
  # ==========================================
  /analytics:
    get:
      tags: [Analytics]
      summary: Analytics gerais do usuário
      description: Retorna dados analíticos gerais de todos os links do usuário
      security:
        - bearerAuth: []
      parameters:
        - name: period
          in: query
          description: Período dos dados
          schema:
            type: string
            enum: [today, week, month, year, all]
            default: month
        - name: start_date
          in: query
          description: Data de início personalizada (formato YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          description: Data de fim personalizada (formato YYYY-MM-DD)
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Dados analíticos gerais
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneralAnalytics'

  # ==========================================
  # REDIRECIONAMENTO
  # ==========================================
  /r/{slug}:
    get:
      tags: [Redirect]
      summary: Redirecionar link encurtado (público)
      description: |
        Endpoint público para redirecionamento. Registra o clique e redireciona para a URL original.
        Não requer autenticação.
      parameters:
        - name: slug
          in: path
          required: true
          description: Slug do link encurtado
          schema:
            type: string
            example: "meu-link"
        - name: utm_source
          in: query
          description: Parâmetro UTM source adicional
          schema:
            type: string
        - name: utm_medium
          in: query
          description: Parâmetro UTM medium adicional
          schema:
            type: string
        - name: utm_campaign
          in: query
          description: Parâmetro UTM campaign adicional
          schema:
            type: string
      responses:
        '302':
          description: Redirecionamento para URL original
          headers:
            Location:
              description: URL de destino
              schema:
                type: string
                format: uri
        '404':
          description: Link não encontrado ou inativo
        '410':
          description: Link expirado

# ==========================================
# COMPONENTS
# ==========================================
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtido através do endpoint de login.
        Formato: `Bearer {token}`

  responses:
    Unauthorized:
      description: Token não fornecido ou inválido
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Token não fornecido"
              message:
                type: string
                example: "Usuário não autenticado"

    NotFound:
      description: Recurso não encontrado
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Recurso não encontrado"
              message:
                type: string
                example: "O recurso solicitado não foi encontrado"

    RateLimitExceeded:
      description: Limite de requisições excedido
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Rate limit exceeded"
              message:
                type: string
                example: "Muitas tentativas. Tente novamente em alguns minutos."
              retry_after:
                type: integer
                example: 60
                description: Segundos até poder tentar novamente

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "João Silva"
        email:
          type: string
          format: email
          example: "joao@exemplo.com"
        email_verified_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        created_at:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    Link:
      type: object
      properties:
        id:
          type: integer
          example: 123
        slug:
          type: string
          example: "meu-link-especial"
        original_url:
          type: string
          format: uri
          example: "https://www.exemplo.com/pagina-longa"
        shorted_url:
          type: string
          format: uri
          example: "https://linkcharts.com/r/meu-link-especial"
        title:
          type: string
          example: "Minha Página Especial"
        description:
          type: string
          example: "Descrição detalhada do link"
        user_id:
          type: integer
          example: 1
        clicks:
          type: integer
          example: 42
          description: Total de cliques no link
        is_active:
          type: boolean
          example: true
        expires_at:
          type: string
          format: date-time
          nullable: true
          example: "2024-12-31T23:59:59Z"
        starts_in:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-01T00:00:00Z"
        utm_source:
          type: string
          nullable: true
          example: "newsletter"
        utm_medium:
          type: string
          nullable: true
          example: "email"
        utm_campaign:
          type: string
          nullable: true
          example: "summer-sale"
        utm_term:
          type: string
          nullable: true
          example: "discount"
        utm_content:
          type: string
          nullable: true
          example: "header-link"
        created_at:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    AuditLog:
      type: object
      properties:
        id:
          type: integer
          example: 1
        link_id:
          type: integer
          example: 123
        action:
          type: string
          enum: [created, updated, deleted, clicked]
          example: "updated"
        old_values:
          type: object
          example: {"title": "Título Antigo"}
          description: Valores anteriores (para updates)
        new_values:
          type: object
          example: {"title": "Novo Título"}
          description: Novos valores (para updates)
        ip_address:
          type: string
          example: "192.168.1.1"
        user_agent:
          type: string
          example: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    LinkAnalytics:
      type: object
      properties:
        total_clicks:
          type: integer
          example: 1250
        unique_visitors:
          type: integer
          example: 875
        avg_daily_clicks:
          type: number
          format: float
          example: 41.7
        clicks_over_time:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
                example: "2024-01-15"
              clicks:
                type: integer
                example: 45
        clicks_by_country:
          type: array
          items:
            type: object
            properties:
              country:
                type: string
                example: "Brasil"
              country_code:
                type: string
                example: "BR"
              total:
                type: integer
                example: 320
        clicks_by_city:
          type: array
          items:
            type: object
            properties:
              city:
                type: string
                example: "São Paulo"
              country:
                type: string
                example: "Brasil"
              total:
                type: integer
                example: 125
        clicks_by_device:
          type: array
          items:
            type: object
            properties:
              device:
                type: string
                enum: [desktop, mobile, tablet]
                example: "mobile"
              total:
                type: integer
                example: 680
        clicks_by_referer:
          type: array
          items:
            type: object
            properties:
              referer:
                type: string
                example: "google.com"
              total:
                type: integer
                example: 245
        clicks_by_user_agent:
          type: array
          items:
            type: object
            properties:
              user_agent:
                type: string
                example: "Chrome"
              total:
                type: integer
                example: 567

    GeneralAnalytics:
      type: object
      properties:
        total_links:
          type: integer
          example: 25
        total_clicks:
          type: integer
          example: 5420
        active_links:
          type: integer
          example: 23
        avg_clicks_per_link:
          type: number
          format: float
          example: 216.8
        top_links:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
                example: 123
              title:
                type: string
                example: "Meu Link Popular"
              slug:
                type: string
                example: "meu-link-popular"
              clicks_count:
                type: integer
                example: 892
              original_url:
                type: string
                example: "https://exemplo.com"
        recent_clicks:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
                example: "2024-01-15"
              total:
                type: integer
                example: 156
        clicks_by_country:
          type: array
          items:
            type: object
            properties:
              country:
                type: string
                example: "Brasil"
              total:
                type: integer
                example: 2340
        clicks_by_device:
          type: array
          items:
            type: object
            properties:
              device:
                type: string
                example: "mobile"
              total:
                type: integer
                example: 3250
        clicks_by_referer:
          type: array
          items:
            type: object
            properties:
              referer:
                type: string
                example: "direct"
              total:
                type: integer
                example: 1890

    ValidationError:
      type: object
      properties:
        message:
          type: string
          example: "The given data was invalid."
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          example:
            email: ["O campo email é obrigatório."]
            password: ["O campo senha deve ter pelo menos 8 caracteres."]
